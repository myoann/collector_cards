function InitializeLoginElements(){$(loginElements.LoginButtonId).click(function(n){n.preventDefault();Login()})}function Login(){var t,i,n;if(ClearLoginErrors(),t=$(loginElements.EmailTextId).val(),i=$(loginElements.PasswordTextId).val(),!t||!i){ShowLoginErrors("Email address or password is empty.");return}n=new FormData;n.append("emailAddress",t);n.append("password",i);$.ajax({type:"POST",url:"?handler=Login",traditional:!0,data:n,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){n.success?document.location.href="/":ShowLoginErrors(n.json)},failure:function(){alert("Catastropic error")}})}function ShowLoginErrors(n){$(loginElements.ErrorId).html("");$(loginElements.ErrorId).html(n);$(loginElements.ErrorContainerId).show()}function ClearLoginErrors(){$(loginElements.ErrorId).html("");$(loginElements.ErrorContainerId).hide()}function InitializeRegisterElements(){$(registerElements.SignUpButtonId).click(function(n){n.preventDefault();SignUp()});$(registerElements.VerifyCodeId).click(function(n){n.preventDefault();VerifyCode()})}function SignUp(){ClearRegisterErrors();var t=$(registerElements.EmailTextId).val(),i=$(registerElements.UsernameTextId).val(),r=$(registerElements.PasswordTextId).val(),u=$(registerElements.ConfirmPasswordTextId).val(),f=$(registerElements.DataId).val(),n=new FormData;n.append("userName",i);n.append("emailAddress",t);n.append("password",r);n.append("confirmPassword",u);n.append("data",f);$.ajax({type:"POST",url:"?handler=Register",traditional:!0,data:n,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){n.success?TransitionToVerify():(console.log(n.json),ShowRegisterValidationErrors(n.json))},failure:function(){alert("Catastropic error")}})}function VerifyCode(){var t,i,n;if(ClearRegisterErrors(),t=$(registerElements.EmailTextId).val(),i=$(registerElements.VerificationCodeId).val(),!t||!i){ShowRegisterErrors("Email address and code are required.");return}n=new FormData;n.append("emailAddress",t);n.append("code",i);$.ajax({type:"POST",url:"?handler=VerifyCode",traditional:!0,data:n,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){n.success?TransitionToRegisterSuccess():ShowRegisterErrors(n.json)},failure:function(){alert("Catastropic error")}})}function TransitionToVerify(){$(registerElements.RegisterContainerId).addClass("dn");$(registerElements.VerifyContainerId).removeClass("dn")}function TransitionToRegisterSuccess(){$(registerElements.VerifyContainerId).addClass("dn");$(registerElements.SuccessContainerId).removeClass("dn")}function ShowRegisterValidationErrors(n){for(var t,i=0;i<n.length;i++)t=n[i],t===AccountValidateErrorType.EmailAddressEmpty||t===AccountValidateErrorType.EmailAddressInvalidFormat?($(registerElements.EmailAddressErrorMessageId).show(),$(registerElements.EmailTextId).addClass(registerElements.RegisterFormInputErrorClassName)):t===AccountValidateErrorType.EmailAddressAlreadyExists?($(registerElements.EmailAddressAlreadyExistsErrorMessageId).show(),$(registerElements.EmailTextId).addClass(registerElements.RegisterFormInputErrorClassName)):t===AccountValidateErrorType.PasswordEmpty?($(registerElements.PasswordErrorMessageId).show(),$(registerElements.PasswordTextId).addClass(registerElements.RegisterFormInputErrorClassName)):t===AccountValidateErrorType.PasswordNotComplicatedEnough?($(registerElements.PasswordNotComplicatedEnoughErrorMessageId).show(),$(registerElements.PasswordTextId).addClass(registerElements.RegisterFormInputErrorClassName)):t===AccountValidateErrorType.UsernameEmpty?($(registerElements.UsernameErrorMessageId).show(),$(registerElements.UsernameTextId).addClass(registerElements.RegisterFormInputErrorClassName)):t===AccountValidateErrorType.UsernameExists?($(registerElements.UsernameAlreadyExistsErrorMessageId).show(),$(registerElements.UsernameTextId).addClass(registerElements.RegisterFormInputErrorClassName)):t===AccountValidateErrorType.ConfirmPasswordInvalid&&($(registerElements.ConfirmErrorMessageId).show(),$(registerElements.ConfirmPasswordTextId).addClass(registerElements.RegisterFormInputErrorClassName))}function ShowRegisterErrors(n){$(registerElements.ErrorId).html("");$(registerElements.ErrorId).html(n);$(registerElements.ErrorId).show()}function ClearRegisterErrors(){$(registerElements.ErrorId).html("");$(registerElements.ErrorId).hide();$(registerElements.EmailAddressErrorMessageId).hide();$(registerElements.UsernameErrorMessageId).hide();$(registerElements.PasswordErrorMessageId).hide();$(registerElements.ConfirmErrorMessageId).hide();$(registerElements.PasswordNotComplicatedEnoughErrorMessageId).hide();$(registerElements.EmailAddressAlreadyExistsErrorMessageId).hide();$(registerElements.UsernameAlreadyExistsErrorMessageId).hide();$(registerElements.EmailTextId).removeClass(registerElements.RegisterFormInputErrorClassName);$(registerElements.UsernameTextId).removeClass(registerElements.RegisterFormInputErrorClassName);$(registerElements.PasswordTextId).removeClass(registerElements.RegisterFormInputErrorClassName);$(registerElements.ConfirmPasswordTextId).removeClass(registerElements.RegisterFormInputErrorClassName)}function InitializeAdvancedPage(){InitializeAdvancedSearchElements();InitializeSearchBoxOnNonSearchPage()}function InitializeAdvancedSearchElements(){$(".search-button").click(function(n){n.preventDefault();RedirectToSearchWithAdvancedSearchString()});$(advancedSearchElements.CardNameId+","+advancedSearchElements.CardTextId+","+advancedSearchElements.PowerId+","+advancedSearchElements.FlavorTextId+","+advancedSearchElements.ArtistId+","+advancedSearchElements.CardNumberId+","+advancedSearchElements.KeywordId+","+advancedSearchElements.ComcCheckboxId+","+advancedSearchElements.CharmsCheckboxId+","+advancedSearchElements.PotionsCheckboxId+","+advancedSearchElements.QuidditchCheckboxId+","+advancedSearchElements.TransfigurationCheckboxId+","+advancedSearchElements.CommonCheckboxId+","+advancedSearchElements.UncommonCheckboxId+","+advancedSearchElements.RareCheckboxId+","+advancedSearchElements.PremiumCheckboxId+","+advancedSearchElements.ProvidesComcCheckboxId+","+advancedSearchElements.ProvidesCharmsCheckboxId+","+advancedSearchElements.ProvidesPotionsCheckboxId+","+advancedSearchElements.ProvidesQuidditchCheckboxId+","+advancedSearchElements.ProvidesTransfigurationCheckboxId).on("keypress",function(n){n.which===13&&(n.preventDefault(),RedirectToSearchWithAdvancedSearchString())});$(".ui.dropdown").dropdown({clearable:!0});$(advancedSearchElements.StatValueInputClassName).on("keypress",function(){event.which!=8&&isNaN(String.fromCharCode(event.which))&&event.preventDefault()});$(advancedSearchElements.StatsValueInputId).on("keyup",function(n){var t;if(n.which===13)n.preventDefault(),RedirectToSearchWithAdvancedSearchString();else{if(!this.value)return;var i=$(advancedSearchElements.StatsTypeId).val(),r=$(advancedSearchElements.StatsOperatorId).val(),u=$(advancedSearchElements.StatsValueInputId).val();AddStatsItem(i,r,u);$(advancedSearchElements.StatsTypeId).prop("selectedIndex",0).change();$(advancedSearchElements.StatsOperatorId).prop("selectedIndex",0).change();$(advancedSearchElements.StatsValueInputId).val("");t=$(".stat-value-input").last();t.select();t[0].selectionStart=t[0].selectionEnd=t.val().length}})}function RedirectToSearchWithAdvancedSearchString(){var t=$(advancedSearchElements.CardNameId).val(),i=$(advancedSearchElements.CardTextId).val(),r=$(advancedSearchElements.CardTypesDropDownId).dropdown("get value"),u=GetLessonsDelimitedString("lessonTypes"),f=$(advancedSearchElements.PowerId).val(),e=$(advancedSearchElements.SetsDropDownId).dropdown("get value"),o=GetRarityDelimitedString(),s=$(advancedSearchElements.FlavorTextId).val(),h=$(advancedSearchElements.ArtistId).val(),c=$(advancedSearchElements.CardNumberId).val(),l=GetLessonsDelimitedString("provides"),a=$(advancedSearchElements.KeywordId).val(),v=GetStatItems(),n=new FormData;t&&n.append("cardName",t);i&&n.append("cardText",i);r&&n.append("cardTypes",r);u&&n.append("lessonTypes",u);f&&n.append("power",f);e&&n.append("sets",e);o&&n.append("rarity",o);s&&n.append("flavorText",s);h&&n.append("artist",h);c&&n.append("cardNumber",c);l&&n.append("provides",l);a&&n.append("keyword",a);v&&n.append("stats",v);$.ajax({type:"POST",url:"advanced?handler=GetAdvancedSearchUrlValue",traditional:!0,data:n,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){if(n.success){var t=n.json,i=location.protocol+"//"+location.host,r="/search?searchText="+t;window.location.href=i+r}},failure:function(){alert("Catastropic error")}})}function GetLessonsDelimitedString(n){var t="";if(n==="lessonTypes"){var i=$(advancedSearchElements.ComcCheckboxId).is(":checked")?"comc,":null,r=$(advancedSearchElements.CharmsCheckboxId).is(":checked")?"c,":null,u=$(advancedSearchElements.PotionsCheckboxId).is(":checked")?"p,":null,f=$(advancedSearchElements.QuidditchCheckboxId).is(":checked")?"q,":null,e=$(advancedSearchElements.TransfigurationCheckboxId).is(":checked")?"t,":null;i&&(t+=i);r&&(t+=r);u&&(t+=u);f&&(t+=f);e&&(t+=e)}else if(n==="provides"){var o=$(advancedSearchElements.ProvidesComcCheckboxId).is(":checked")?"comc,":null,s=$(advancedSearchElements.ProvidesCharmsCheckboxId).is(":checked")?"c,":null,h=$(advancedSearchElements.ProvidesPotionsCheckboxId).is(":checked")?"p,":null,c=$(advancedSearchElements.ProvidesQuidditchCheckboxId).is(":checked")?"q,":null,l=$(advancedSearchElements.ProvidesTransfigurationCheckboxId).is(":checked")?"t,":null;o&&(t+=o);s&&(t+=s);h&&(t+=h);c&&(t+=c);l&&(t+=l)}return t.slice(0,-1).trim()}function GetRarityDelimitedString(){var n="",t=$(advancedSearchElements.CommonCheckboxId).is(":checked")?"c,":null,i=$(advancedSearchElements.UncommonCheckboxId).is(":checked")?"u,":null,r=$(advancedSearchElements.RareCheckboxId).is(":checked")?"r,":null,u=$(advancedSearchElements.PremiumCheckboxId).is(":checked")?"r,":null;return t&&(n+=t),i&&(n+=i),r&&(n+=r),u&&(n+=u),n.slice(0,-1).trim()}function AddStatsItem(n,t,i){var r="<option>Health<\/option>";n==="Health"?r='<option selected="selected">Health<\/option>':n==="Damage"&&(r='<option selected="selected">Damage<\/option>');var f="<option>greater than<\/option>",e="<option>greater than or equal to<\/option>",o="<option>less than<\/option>",s="<option>less than or equal to<\/option>",h="<option>equal to<\/option>";t==="greater than"?f='<option selected="selected">greater than<\/option>':t==="greater than or equal to"?e='<option selected="selected">greater than or equal to<\/option>':t==="less than"?o='<option selected="selected">less than<\/option>':t==="less than or equal to"?s='<option selected="selected">less than or equal to<\/option>':t==="equal to"&&(h='<option selected="selected">equal to<\/option>');var l='<input class="stat-value-input input-reset pl2 ml2" type="text" value="'+i+'" />',u=Math.floor(Math.random()*1e9),c="remove"+u,a=`
        <div id="`+u+`" class="flex flex-items-start mt2">
           <div class="fl ml3">
              <select class="select-stats">
                 `+r+`
                 `+"<option>Damage<\/option>"+`
              </select>
           </div>
           <div class="fl ml2">
               <select class="select-stats">
                    `+f+`
                    `+e+`
                    `+o+`
                    `+s+`
                    `+h+`
               </select>
           </div>
           <div class="fl">
               `+l+`
           </div>
           <div class="fl">
               <div id="`+c+`" class="ml2 stat-item-delete-img"></div>
           </div>
        </div>
    `;$(advancedSearchElements.StatsIemsContainerId).append(a);$("#"+c).click(function(){$("#"+u).remove()})}function GetStatItems(){var n="";return $(advancedSearchElements.StatsIemsContainerId+" >  div").each(function(){$(this).each(function(){var r=$(this).find("select")[0],u=$(this).find("select")[1],f=$(this).find("input")[0],t=$(r).find(":selected").text(),e=$(u).find(":selected").text(),o=$(f).val(),i;if(n.includes(t))return!0;i=t+"|"+e+"|"+o;n+=i+";"})}),n}function InitializeCardPage(){InitializeSearchBoxOnNonSearchPage()}function InitializeLayout(){InitializeLayouElements()}function InitializeLayouElements(){$(searchElementNames.SearchInputId).on("keyup",function(){var n=$(searchElementNames.ClearSearchClassName);$(this).val()===""?n.hasClass("vh")||n.addClass("vh"):n.hasClass("vh")&&n.removeClass("vh")});$(searchElementNames.ClearSearchClassName).on("click",function(){var n=$(searchElementNames.SearchInputId);n.val("");$(this).addClass("vh")})}function GetCurrentPage(){return window.location.pathname.split("/")[1]}function InitializeSearchBoxOnNonSearchPage(){$(searchElementNames.SearchInputId).on("keypress",function(n){n.which===13&&(window.location.href="/search?searchText="+$(this).val()+"&sortBy=sn&cardView=images",n.preventDefault())})}function getParameterByName(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function until(n){const t=i=>{n()?i():setTimeout(()=>t(i),400)};return new Promise(t)}function InitializeHomePage(){InitializeSearchBoxOnNonSearchPage()}function InitializeSearchPage(){SetCardSets();InitializeCardSearchElements();SetValuesFromQueryAndPeformCardSearch();InitializeCardTable()}function SetCardSets(){$.ajax({type:"POST",url:"search?handler=GetSets",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){if(n.success){var t=n.json;AddSetsToDropDown(t)}},failure:function(){alert("Catastropic error")}})}function AddSetsToDropDown(n){const t=$(searchElementNames.SetId);t.find("option").remove();t.append('<option value="">All Sets<\/option>');n.forEach(n=>t.append(`<option value="${n.shortName.toLowerCase()}">${n.name}</option>`));hasSetsLoaded=!0}function InitializeCardSearchElements(){$(searchElementNames.SearchInputId).on("keypress",function(n){n.which===13&&(SearchCards(),n.preventDefault())});$(searchElementNames.SetId).on("change",function(){SearchCards()});$(searchElementNames.CardViewId).on("change",function(){ToggleViewSearch()});$(searchElementNames.SortCardsById).on("change",function(){var n=GetSearchData();(n.SetName||n.LessonCost||n.SearchText)&&n.SortBy&&SearchCards()});$(searchElementNames.SortCardsOrderId).on("change",function(){var n=GetSearchData();(n.SetName||n.LessonCost||n.SearchText)&&SearchCards()})}function InitializeCardTable(){var n=$.fn.dataTable.absoluteOrder({value:"",position:"bottom"});cardTable=$(resultsContainerNames.CardTableId).DataTable({lengthChange:!1,searching:!1,paging:!1,bInfo:!1,columnDefs:[{targets:[CardTableColumnIndex.CardId,CardTableColumnIndex.ImageUrl,CardTableColumnIndex.Lesson],visible:!1},{targets:[CardTableColumnIndex.Number],type:"natural-nohtml"},{targets:[CardTableColumnIndex.Lesson],type:n}],createdRow:function(n,t){$("td",n).on("mouseover",function(){var i=t[CardTableColumnIndex.ImageUrl],u=t[CardTableColumnIndex.CardId],n=$(searchElementNames.HoverImageClassName),r;n.attr("src")!==i&&(r=GetCardFromCardId(u),r.orientation==="Horizontal"&&n.addClass("hover-card-rotate"),n.attr("src",""),n.removeClass("dn"),n.attr("src",i))});$("td",n).on("mouseleave",function(){var n=$(searchElementNames.HoverImageClassName);n.addClass("dn");n.removeClass("hover-card-rotate")})}});$(resultsContainerNames.CardTableId+" tbody").on("click","tr",function(){for(var t,i,r=cardTable.row(this).data(),n=0;n<cards.length;n++)t=cards[n],t.cardId===r[0]&&(i=location.protocol+"//"+location.host,window.location.href=i+t.cardPageUrl)})}function GetCardFromCardId(n){for(var i,r=null,t=0;t<this.cards.length;t++)i=cards[t],i.cardId===n&&(r=i);return r}function SearchCards(){HideAllContainers();ToggleSearchLoading();const n=GetSearchData();SetQueryFromValues(n);ToggleSearchResultData();var t=new FormData;n.SetName&&t.append("set",n.SetName);n.SearchText&&t.append("searchText",n.SearchText);n.SortBy&&t.append("sortBy",n.SortBy);n.SortOrder&&t.append("sortOrder",n.SortOrder);$.ajax({type:"POST",url:"search?handler=SearchCards",data:t,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){if(n.success){if(ToggleSearchLoading(),UnHideAllContainers(),cards=n.json,cards.length===1){window.location.href=GenerateCardUrl(cards[0]);return}$(searchElementNames.CardCountId).html(cards.length+" cards");AddCardsToContainer(cards)}},failure:function(){alert("Catastropic error")}})}async function SetValuesFromQueryAndPeformCardSearch(){var n=getParameterByName(searchQueryParameterNames.SetName),t=getParameterByName(searchQueryParameterNames.SearchText),i=getParameterByName(searchQueryParameterNames.SortBy),r=getParameterByName(searchQueryParameterNames.SortOrder),u=getParameterByName(searchQueryParameterNames.CardView);t&&$(searchElementNames.SearchInputId).val(t);i&&$(searchElementNames.SortCardsById).val(i);r&&$(searchElementNames.SortCardsOrderId).val(r);u&&$(searchElementNames.CardViewId).val(u);n&&(await until(()=>hasSetsLoaded===!0),$(searchElementNames.SetId).val(n));n||t?SearchCards():PopulateDefaultCards()}function GetSearchData(){var n=$(searchElementNames.SetId).val(),t=$(searchElementNames.SearchInputId).val().trim(),i=$(searchElementNames.SortCardsById).val(),r=$(searchElementNames.SortCardsOrderId).val(),u=$(searchElementNames.CardViewId).val();return{SetName:n,SearchText:t,SortBy:i,SortOrder:r,CardView:u}}function PopulateDefaultCards(){HideAllContainers();ToggleSearchLoading();$.ajax({type:"POST",url:"search?handler=GetPopularCards",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){n.success&&(ToggleSearchLoading(),UnHideAllContainers(),cards=n.json,AddCardsToContainer(cards))},failure:function(){alert("Catastropic error")}})}function ToggleViewSearch(){if(cards!==null){const n=GetSearchData();SetQueryFromValues(n);AddCardsToContainer(cards)}else SearchCards()}function ToggleViewContainers(){var t=$(resultsContainerNames.NoCardsContainerId),n;t.hasClass("dn")||t.addClass("dn");n=$(searchElementNames.CardViewId).val();n==="images"?($(resultsContainerNames.CardTableContainerId).removeClass("db"),$(resultsContainerNames.CardTableContainerId).addClass("dn"),$(resultsContainerNames.CardContainerId).removeClass("dn"),$(resultsContainerNames.CardContainerId).addClass("flex")):n==="listview"&&($(resultsContainerNames.CardContainerId).removeClass("flex"),$(resultsContainerNames.CardContainerId).addClass("dn"),$(resultsContainerNames.CardTableContainerId).removeClass("dn"),$(resultsContainerNames.CardTableContainerId).addClass("db"))}function ToggleSearchResultData(){var t=getParameterByName(searchQueryParameterNames.SetName),i=getParameterByName(searchQueryParameterNames.SearchText),n;$(resultsContainerNames.SearchResultsContainerId).removeClass("dn");$(resultsContainerNames.SetInfoContainerId).removeClass("dn");t&&!i?($(resultsContainerNames.SearchResultsContainerId).addClass("dn"),n=new FormData,n.append("setShortName",t),$.ajax({type:"POST",url:"search?handler=GetSetByShortName",data:n,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){var t,i;n.success&&(t=n.json,$(resultsContainerNames.SetHeaderIconClassName).attr("data","/images/seticons/"+t.iconFileName),$(resultsContainerNames.SetHeaderTitleClassName).html(t.name),i=t.totalCards+" cards • Released "+t.releaseDate,$(resultsContainerNames.SetHeaderDataClassName).html(i))},failure:function(){alert("Catastropic error")}})):$(resultsContainerNames.SetInfoContainerId).addClass("dn")}function AddCardsToContainer(n){n.length<=0?$(resultsContainerNames.NoCardsContainerId).removeClass("dn"):ToggleViewContainers();var t=$(searchElementNames.CardViewId).val();t==="images"?AddCardsToDeck(n):t==="listview"&&AddCardsToTable(n)}function GenerateCardUrl(n){return n&&`${location.protocol}//${location.host}${n.cardPageUrl}`}function AddCardsToDeck(n){var i;for($(resultsContainerNames.CardContainerId).html(""),i=0;i<n.length;i++){var t=n[i],u=GetImageFromCardImages(t,ImageSizeType.Small),f=t.orientation==="Horizontal"&&!IsMobile?'onmouseover="RotateCardHorizontally(this);" onmouseleave="RotateCardVertically(this);" touchend="RotateCardVertically(this);"':"",e=GenerateCardUrl(t),o=`
                        <a `+f+` href="`+e+`" class="card-image w-25-ns pa1 w-50">
                            <img class="card-image tc" id="`+t.cardId+`" data-cardname="`+t.detail.name+`" src="`+u.url+`" />
                        </a>
                    `,r=$(resultsContainerNames.CardContainerId).html();r+=o;$(resultsContainerNames.CardContainerId).html(r);$(".card-image").on("load",function(){$(this).removeClass("d-none");$(this).addClass("animated fadeIn")}).on("error",function(){}).each(function(){this.complete&&$(this).trigger("load")})}}function AddCardsToTable(n){var i,o,s,r,h,c,b;for(cardTable.clear().draw(),i=0;i<n.length;i++){var t=n[i],l=t.cardId,u=t.lessonCost===null?"":t.lessonCost,a=GetSetIconImageElement(t.cardSet.iconFileName),v=t.cardNumber,y="<b>"+t.detail.name+"<\/b>",p=GetImageFromCardImages(t,ImageSizeType.Small),w=p.url,e="",f=null;t.lessonType===null?f=u:t.lessonType!==null&&u!==""&&(o=GetLessonImageElementFromLessonType(t.lessonType.name),f='<label class="card-table-cell-lesson-label">'+u+"<\/label>"+o,e=t.lessonType.name);s=t.cardType.name;r=null;t.rarity.imageName===null?r=t.rarity.symbol:(h=GetRarityImageElement(t.rarity.imageName),r=t.rarity.symbol+h);c=t.detail.illustrator;b=cardTable.row.add([l,a,v,y,f,s,r,c,w,e])}ApplySortToCardTable();cardTable.rows().every(function(t){for(var i,u,f=$(this.node()),e=cardTable.cell(t,CardTableColumnIndex.CardId).data(),r=0;r<n.length;r++)i=n[r],i.cardId===e&&i.lessonType!==null&&(u=GetLessonColorClass(i),f.find("td").eq(CardTableColumnIndex.Cost-1).addClass(u))})}function ApplySortToCardTable(){var t=$(searchElementNames.SortCardsById).val(),n=$(searchElementNames.SortCardsOrderId).val();t===SortBy.SetNumber?cardTable.order([CardTableColumnIndex.Set,n],[CardTableColumnIndex.Number,n]).draw():t===SortBy.Name?cardTable.order([CardTableColumnIndex.Name,n]).draw():t===SortBy.Cost?cardTable.order([CardTableColumnIndex.Cost,n]).draw():t===SortBy.Type?cardTable.order([CardTableColumnIndex.Type,n]).draw():t===SortBy.Rarity?cardTable.order([CardTableColumnIndex.Rarity,n]).draw():t===SortBy.Artist?cardTable.order([CardTableColumnIndex.Artist,n]).draw():t===SortBy.Lesson&&cardTable.order([CardTableColumnIndex.Lesson,n],[CardTableColumnIndex.Name,n]).draw()}function GetLessonImageElementFromLessonType(n){return n===LessonTypeName.CareOfMagicalCreatures?'<img class="card-table-cell-lesson-image" src="/images/lessons/care-of-magical-creatures.svg" />':n===LessonTypeName.Charms?'<img class="card-table-cell-lesson-image" src="/images/lessons/charms.svg" />':n===LessonTypeName.Potions?'<img class="card-table-cell-lesson-image" src="/images/lessons/potions.svg" />':n===LessonTypeName.Quidditch?'<img class="card-table-cell-lesson-image" src="/images/lessons/quidditch.svg" />':n===LessonTypeName.Transfiguration?'<img class="card-table-cell-lesson-image" src="/images/lessons/transfiguration.svg" />':void 0}function GetRarityImageElement(n){return'<img class="card-table-cell-rarity-image" src="/images/rarities/'+n+'" />'}function GetSetIconImageElement(n){return'<img class="card-table-cell-icon-image" src="/images/seticons/'+n+'" />'}function RotateCardHorizontally(n){n.style.transform="rotate(90deg)";n.style.position="relative";n.style.zIndex="9999"}function RotateCardVertically(n){n.style.transform="rotate(0deg)";n.style.zIndex="0"}function SetQueryFromValues(n){if(n.SetName||n.LessonCost||n.SearchText){var i=window.location.href.split("?")[0],t="?";n.SetName&&(t+=searchQueryParameterNames.SetName+"="+n.SetName+"&");n.SearchText&&(t+=searchQueryParameterNames.SearchText+"="+n.SearchText+"&");n.SortBy&&(t+=searchQueryParameterNames.SortBy+"="+n.SortBy+"&");n.SortOrder&&(t+=searchQueryParameterNames.SortOrder+"="+n.SortOrder+"&");n.CardView&&(t+=searchQueryParameterNames.CardView+"="+n.CardView+"&");t=t.slice("&",-1);history.pushState(null,null,i+t)}}function GetLessonColorClass(n){if(n.lessonCost===null||n.lessonType===null)return"";var t=n.lessonType;return t.name===LessonTypeName.CareOfMagicalCreatures?"lesson-color-comc":t.name===LessonTypeName.Charms?"lesson-color-charms":t.name===LessonTypeName.Potions?"lesson-color-potions":t.name===LessonTypeName.Quidditch?"lesson-color-quidditch":t.name===LessonTypeName.Transfiguration?"lesson-color-transfig":void 0}function ToggleSearchLoading(){var n=$("#loading");n.hasClass("dn")?n.removeClass("dn"):n.addClass("dn")}function HideAllContainers(){var n=$(resultsContainerNames.CardTableContainerId),t=$(resultsContainerNames.CardContainerId),i=$(resultsContainerNames.NoCardsContainerId);n.hasClass("vh")||n.addClass("vh");t.hasClass("vh")||t.addClass("vh");i.hasClass("vh")||i.addClass("vh")}function UnHideAllContainers(){var n=$(resultsContainerNames.CardTableContainerId),t=$(resultsContainerNames.CardContainerId),i=$(resultsContainerNames.NoCardsContainerId);n.hasClass("vh")&&n.removeClass("vh");t.hasClass("vh")&&t.removeClass("vh");i.hasClass("vh")&&i.removeClass("vh")}function GetImageFromCardImages(n,t){for(var r,u=n.images,i=0;i<u.length;i++)if(r=u[i],r.size===t)return r}function InitializeSetsPage(){InitializeSetsTable();PopulateSetsTable();InitializeSearchBoxOnNonSearchPage()}function InitializeSetsTable(){setsTable=$(setsPageElements.SetsTableId).DataTable({lengthChange:!1,searching:!1,paging:!1,bInfo:!1,columnDefs:[{targets:[0],visible:!1},{targets:[1],className:"fl w-100"},{targets:[2,3],width:"10%"},{targets:[4],className:"v-mid"}]});$(setsPageElements.SetsTableId+" tbody").on("click","tr",function(){var n=setsTable.row(this).data();window.location.href="/search?set="+n[0]+"&sortBy=sn&cardView=images"})}function PopulateSetsTable(){$.ajax({type:"POST",url:"Sets?handler=GetSets",beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(n){if(n.success){var t=n.json;AddSetsToSetsTable(t)}},failure:function(){alert("Catastropic error")}})}function AddSetsToSetsTable(n){for(var r,f,e,o,a,i=0;i<n.length;i++){var t=n[i],s=t.shortName.toLowerCase(),h='<div class="flex items-center"><img class="sets-set-table-set-icon" src="/images/seticons/'+t.iconFileName+'" /><div>'+t.name+"<\/div><\/div>",c=t.totalCards,l=t.releaseDate,u='<div class="flex items-center">';for(r=0;r<t.languages.length;r++)f=t.languages[r],e="",e=f.enabled?"set-language-enabled":"set-language-disabled",u+='<div class="'+e+'">'+f.code+"<\/div>";u+="<\/div>";o=u;a=setsTable.row.add([s,h,c,l,o]);setsTable.order([SetsTableColumnIndex.ReleaseDate,"desc"]).draw()}}var currentPage,IsMobile,hasSetsLoaded,cards,cardTable,setsTable;const loginElements={LoginButtonId:"#login",EmailTextId:"#emailAddress",PasswordTextId:"#password",LoginContainerId:"#loginContainer",ErrorContainerId:"#errorContainer",ErrorId:"#error"};$(document).ready(function(){InitializeLoginElements()});const registerElements={UsernameTextId:"#username",EmailTextId:"#emailAddress",PasswordTextId:"#password",SignUpButtonId:"#signUp",ErrorContainerId:"#errorContainer",ErrorId:"#error",DataId:"#data",RegisterContainerId:"#registerContainer",VerifyContainerId:"#verifyContainer",VerifyEmailAddressId:"#verifyEmailAddress",VerificationCodeId:"#verificationCode",VerifyCodeId:"#verifyCode",SuccessContainerId:"#successContainer",EmailAddressErrorMessageId:"#emailAddressErrorMessage",UsernameErrorMessageId:"#usernameErrorMessage",PasswordErrorMessageId:"#passwordErrorMessage",ConfirmErrorMessageId:"#confirmErrorMessage",ConfirmPasswordTextId:"#confirmPassword",RegisterFormInputErrorClassName:"register-form-input-error",PasswordNotComplicatedEnoughErrorMessageId:"#passwordNotComplicatedEnoughErrorMessage",EmailAddressAlreadyExistsErrorMessageId:"#emailAddressAlreadyExistsErrorMessage",UsernameAlreadyExistsErrorMessageId:"#usernameAlreadyExistsErrorMessage"},AccountValidateErrorType={EmailAddressEmpty:0,EmailAddressInvalidFormat:1,EmailAddressAlreadyExists:2,PasswordEmpty:3,PasswordTooShort:4,PasswordNotComplicatedEnough:5,UsernameEmpty:6,UsernameExists:7,ConfirmPasswordInvalid:8};$(document).ready(function(){InitializeRegisterElements()});const advancedSearchElements={CardNameId:"#cardName",CardTextId:"#cardText",SetsDropDownId:"#sets",CardTypesDropDownId:"#cardTypes",PowerId:"#power",ComcCheckboxId:"#comcCheckbox",CharmsCheckboxId:"#charmsCheckbox",PotionsCheckboxId:"#potionsCheckbox",QuidditchCheckboxId:"#quidditchCheckbox",TransfigurationCheckboxId:"#transfigurationCheckbox",ProvidesComcCheckboxId:"#providesComcCheckbox",ProvidesCharmsCheckboxId:"#providesCharmsCheckbox",ProvidesPotionsCheckboxId:"#providesPotionsCheckbox",ProvidesQuidditchCheckboxId:"#providesQuidditchCheckbox",ProvidesTransfigurationCheckboxId:"#providesTransfigurationCheckbox",CommonCheckboxId:"#commonCheckbox",UncommonCheckboxId:"#uncommonCheckbox",RareCheckboxId:"#rareCheckbox",PremiumCheckboxId:"#premiumCheckbox",FlavorTextId:"#flavorText",ArtistId:"#artist",CardNumberId:"#cardNumber",KeywordId:"#keyword",StatsValueInputId:"#statsValueInput",StatsTypeId:"#statsType",StatsOperatorId:"#statsOperator",StatsIemsContainerId:"#statsIemsContainer",StatValueInputClassName:".stat-value-input"};currentPage=null;const Page={Home:"",Search:"search",Card:"card",Sets:"sets",Advanced:"advanced",DeckBuilder:"deckbuilder"};IsMobile=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(IsMobile=!0);$(document).ready(function(){InitializeLayout();currentPage=GetCurrentPage();currentPage===Page.Home?InitializeHomePage():currentPage===Page.Search?InitializeSearchPage():currentPage===Page.Card?InitializeCardPage():currentPage===Page.Sets?InitializeSetsPage():currentPage===Page.Advanced?InitializeAdvancedPage():currentPage===Page.DeckBuilder&&InitializeDeckBuilderPage()});const searchQueryParameterNames={SetName:"set",SearchText:"searchText",SortBy:"sortBy",SortOrder:"sortOrder",CardView:"cardView",CardId:"cardId"},searchElementNames={SetId:"#setSelect",SearchInputId:"#searchInput",SortCardsById:"#sortCardsBy",CardModalId:"#cardModal",SortCardsOrderId:"#sortCardsOrder",CardViewId:"#cardView",CardCountId:"#cardCount",SetDateClassName:".set-date",ClearSearchClassName:".clear-search",HoverImageClassName:".hover-card"},resultsContainerNames={ContentContainerId:"#contentContainer",CardContainerId:"#cardContainer",CardTableId:"#cardTable",CardTableContainerId:"#tableContainer",SearchResultsContainerId:"#searchResults",SetInfoContainerId:"#setInfo",SetHeaderIconClassName:".set-header-title-icon",SetHeaderTitleClassName:".set-header-title-h1",SetHeaderDataClassName:".set-header-title-data",NoCardsContainerId:"#noCardsContainer"},ImageSizeType={Small:0,Medium:1,Large:2},CardTableColumnIndex={CardId:0,Set:1,Number:2,Name:3,Cost:4,Type:5,Rarity:6,Artist:7,ImageUrl:8,Lesson:9},SortBy={SetNumber:"sn",Name:"name",Cost:"cost",Type:"type",Rarity:"rarity",Artist:"artist",Lesson:"lesson"},SortOrder={Ascending:"asc",Descending:"desc"},LessonTypeName={CareOfMagicalCreatures:"Care of Magical Creatures",Charms:"Charms",Potions:"Potions",Quidditch:"Quidditch",Transfiguration:"Transfiguration"};$(document).mousemove(function(n){var t=$(searchElementNames.HoverImageClassName),i=window.scrollY;t.css({top:i+n.clientY,left:n.clientX+20})});hasSetsLoaded=!1;cards=null;cardTable=null;const setsPageElements={SetsTableId:"#setsTable"},SetsTableColumnIndex={SetId:0,Name:1,TotalCards:2,ReleaseDate:3,Languages:4};setsTable=null;